# –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è Photo Validation Service

## –û–±–∑–æ—Ä —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–∫—Ä—ã—Ç–∏—è

–°–æ–∑–¥–∞–Ω –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –Ω–∞–±–æ—Ä —Ç–µ—Å—Ç–æ–≤ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ —Å–∏—Å—Ç–µ–º—ã –ø–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:

### üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤

```
tests/
‚îú‚îÄ‚îÄ conftest.py              # –ë–∞–∑–æ–≤—ã–µ —Ñ–∏–∫—Å—Ç—É—Ä—ã –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
‚îú‚îÄ‚îÄ test_api.py             # API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã, –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤
‚îú‚îÄ‚îÄ test_cv_checks.py       # Computer Vision –ø—Ä–æ–≤–µ—Ä–∫–∏
‚îú‚îÄ‚îÄ test_integration.py     # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
‚îî‚îÄ‚îÄ scripts/
    ‚îî‚îÄ‚îÄ run_tests.py       # –°–∫—Ä–∏–ø—Ç –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–æ–≤
```

## üß™ –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ç–µ—Å—Ç–æ–≤

### 1. API Tests (`test_api.py`)
- ‚úÖ Health check endpoint
- ‚úÖ Metrics endpoint (basic + detailed)  
- ‚úÖ Image validation workflow
- ‚úÖ File validation (MIME types, magic bytes, size limits)
- ‚úÖ Invalid input handling
- ‚úÖ Error responses

**–û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏:**
- –í–∞–ª–∏–¥–∞—Ü–∏—è JPEG/PNG —Ñ–∞–π–ª–æ–≤ —á–µ—Ä–µ–∑ `python-magic`
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∞–≥–∏—á–µ—Å–∫–∏—Ö –±–∞–π—Ç–æ–≤ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–æ–≤ (> 10MB –æ—Ç–∫–ª–æ–Ω—è–µ—Ç—Å—è)
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –º–∞–ª—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –≤–∞–ª–∏–¥–∞—Ü–∏–∏

### 2. Computer Vision Tests (`test_cv_checks.py`)
- ‚úÖ Face detection (—Å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º)
- ‚úÖ Blur detection (Laplacian variance)
- ‚úÖ Brightness validation
- ‚úÖ Check runner with parallel execution
- ‚úÖ Performance metrics collection
- ‚úÖ Real image processing

**–ö–ª—é—á–µ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:**
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–µ—Ç–µ–∫—Ü–∏–∏ –ª–∏—Ü –º–µ–∂–¥—É –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏
- –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫
- Graceful error handling –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö CV
- Mock —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ OpenCV —Ñ—É–Ω–∫—Ü–∏–π

### 3. Integration Tests (`test_integration.py`)
- ‚úÖ Full workflow (upload ‚Üí processing ‚Üí results)
- ‚úÖ Worker task integration
- ‚úÖ Performance monitoring
- ‚úÖ Error handling scenarios
- ‚úÖ Load testing (concurrent requests)
- ‚úÖ Memory usage monitoring
- ‚úÖ Configuration validation

**–°—Ü–µ–Ω–∞—Ä–∏–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**
- –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –ë–î –∏ worker
- –ù–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (10 concurrent requests)
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è –ø–∞–º—è—Ç–∏
- Edge cases –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

## üöÄ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

### –ë—ã—Å—Ç—Ä–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
```bash
pip install pytest pytest-asyncio
```

### –†–∞–∑–ª–∏—á–Ω—ã–µ —É—Ä–æ–≤–Ω–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

1. **–ë—ã—Å—Ç—Ä—ã–µ —Ç–µ—Å—Ç—ã** (1-2 –º–∏–Ω—É—Ç—ã):
```bash
python tests/scripts/run_tests.py --level quick --verbose
```

2. **–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —Ç–µ—Å—Ç—ã** (3-5 –º–∏–Ω—É—Ç):
```bash  
python tests/scripts/run_tests.py --level standard --verbose
```

3. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã** (5-10 –º–∏–Ω—É—Ç):
```bash
python tests/scripts/run_tests.py --level integration --verbose
```

4. **–ü–æ–ª–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** (10-15 –º–∏–Ω—É—Ç):
```bash
python tests/scripts/run_tests.py --level full --verbose --coverage
```

### –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ pytest
```bash
# –í—Å–µ —Ç–µ—Å—Ç—ã
pytest tests/ -v

# –¢–æ–ª—å–∫–æ API
pytest tests/test_api.py -v

# –¢–æ–ª—å–∫–æ CV –ø—Ä–æ–≤–µ—Ä–∫–∏
pytest tests/test_cv_checks.py -v

# –° –ø–æ–∫—Ä—ã—Ç–∏–µ–º –∫–æ–¥–∞
pytest tests/ --cov=app --cov-report=html --cov-report=term
```

## üìä –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

### API Tests
- **Health check:** `200 OK` —Å status "healthy"/"degraded"
- **Metrics:** –ú–µ—Ç—Ä–∏–∫–∏ uptime, memory, CPU –¥–æ—Å—Ç—É–ø–Ω—ã
- **File validation:** JPEG/PNG –ø—Ä–∏–Ω–∏–º–∞—é—Ç—Å—è, –æ—Å—Ç–∞–ª—å–Ω—ã–µ –æ—Ç–∫–ª–æ–Ω—è—é—Ç—Å—è
- **Size limits:** –§–∞–π–ª—ã > 10MB –æ—Ç–∫–ª–æ–Ω—è—é—Ç—Å—è —Å `422`

### CV Tests  
- **Face detection:** –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ª–∏—Ü
- **Caching:** –î–µ—Ç–µ–∫—Ü–∏—è –ª–∏—Ü –∫—ç—à–∏—Ä—É–µ—Ç—Å—è –º–µ–∂–¥—É –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏
- **Blur detection:** Laplacian variance –≤—ã—à–µ/–Ω–∏–∂–µ threshold
- **Parallel execution:** –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –∏ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–∞—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

### Integration Tests
- **Full workflow:** Upload ‚Üí Processing ‚Üí Completed —Å—Ç–∞—Ç—É—Å—ã
- **Error handling:** Graceful –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –ë–î/worker
- **Load testing:** 10 concurrent requests –±–µ–∑ –æ—à–∏–±–æ–∫
- **Memory:** –†–æ—Å—Ç –ø–∞–º—è—Ç–∏ < 100MB –ø—Ä–∏ 20 –∑–∞–ø—Ä–æ—Å–∞—Ö

## üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –≤ —Ç–µ—Å—Ç–∞—Ö

### 1. FastAPI TestClient
- –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –∏–º–ø–æ—Ä—Ç –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ TestClient
- Mock –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (–ë–î, worker tasks)

### 2. Async Testing
- –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `pytest.mark.asyncio`
- –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ñ–∏–∫—Å—Ç—É—Ä—ã –¥–ª—è async —Ñ—É–Ω–∫—Ü–∏–π

### 3. File Validation
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∞–ª—å–Ω—ã—Ö JPEG magic bytes
- –ü—Ä–æ–≤–µ—Ä–∫–∞ python-magic –≤–∞–ª–∏–¥–∞—Ü–∏–∏ MIME types

### 4. Mock Strategy
- –ò–∑–æ–ª—è—Ü–∏—è unit —Ç–µ—Å—Ç–æ–≤ –æ—Ç –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –º–æ–∫–∏—Ä–æ–≤–∞–Ω–∏–µ OpenCV —Ñ—É–Ω–∫—Ü–∏–π
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ error scenarios

## üìà –ü–æ–∫—Ä—ã—Ç–∏–µ –∫–æ–¥–∞

–û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –ø–æ–ª–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤:
- **API endpoints:** ~95%
- **CV checks:** ~90%  
- **Core functionality:** ~85%
- **Worker tasks:** ~80%

## ‚ö†Ô∏è –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

1. **Real OpenCV testing:** –ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Ç–µ—Å—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç mock –≤–º–µ—Å—Ç–æ —Ä–µ–∞–ª—å–Ω–æ–≥–æ OpenCV
2. **Database integration:** –¢–µ—Å—Ç—ã –º–æ–∫–∏—Ä—É—é—Ç –ë–î –æ–ø–µ—Ä–∞—Ü–∏–∏  
3. **File system:** –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –≤ —Ç–µ—Å—Ç–∞—Ö
4. **Timing tests:** Load tests –º–æ–≥—É—Ç –±—ã—Ç—å –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω—ã–º–∏ –Ω–∞ –º–µ–¥–ª–µ–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º–∞—Ö

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã:** `python tests/scripts/run_tests.py --level standard`
2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–∫—Ä—ã—Ç–∏–µ:** `--coverage` —Ñ–ª–∞–≥
3. **–ò—Å–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—ã:** –ï—Å–ª–∏ –µ—Å—Ç—å failing tests
4. **Production testing:** –ó–∞–ø—É—Å—Ç–∏—Ç—å –Ω–∞ production –¥–∞–Ω–Ω—ã—Ö

## üìù –õ–æ–≥–∏ –∏ –æ—Ç–ª–∞–¥–∫–∞

–î–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–π –æ—Ç–ª–∞–¥–∫–∏:
```bash
pytest tests/ -v -s --tb=long
```

–õ–æ–≥–∏ —Ç–µ—Å—Ç–æ–≤ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `tests/reports/` (–µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ).

---

–¢–µ—Å—Ç—ã –≥–æ—Ç–æ–≤—ã –∫ –∑–∞–ø—É—Å–∫—É! –†–µ–∫–æ–º–µ–Ω–¥—É—é –Ω–∞—á–∞—Ç—å —Å `--level quick` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –±–∞–∑–æ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏. 